window.LCalendar=function(){var e=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxD=31};e.prototype={init:function(e){this.type=e.type;this.trigger=document.querySelector(e.trigger);if(this.trigger.getAttribute("data-lcalendar")!=null){var t=this.trigger.getAttribute("data-lcalendar").split(",");var a=t[0].split("-");this.minY=~~a[0];this.minM=~~a[1];this.minD=~~a[2];var r=t[1].split("-");this.maxY=~~r[0];this.maxM=~~r[1];this.maxD=~~r[2]}if(e.minDate){var a=e.minDate.split("-");this.minY=~~a[0];this.minM=~~a[1];this.minD=~~a[2]}if(e.maxDate){var r=e.maxDate.split("-");this.maxY=~~r[0];this.maxM=~~r[1];this.maxD=~~r[2]}this.bindEvent(this.type)},bindEvent:function(e){var t=this;function a(e){t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+'<div class="date_roll_mask">'+'<div class="date_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_dd" data-datetype="date_dd"></div>'+'<div class="date_grid">'+"<div>日</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";document.body.appendChild(t.gearDate);r();var a=t.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var i=t.gearDate.querySelector(".lcalendar_finish");i.addEventListener("touchstart",f);var d=t.gearDate.querySelector(".date_yy");var n=t.gearDate.querySelector(".date_mm");var s=t.gearDate.querySelector(".date_dd");d.addEventListener("touchstart",m);n.addEventListener("touchstart",m);s.addEventListener("touchstart",m);d.addEventListener("touchmove",g);n.addEventListener("touchmove",g);s.addEventListener("touchmove",g);d.addEventListener("touchend",_);n.addEventListener("touchend",_);s.addEventListener("touchend",_)}function r(){var e=new Date;var a={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(t.trigger.value)){rs=t.trigger.value.match(/(^|-)\d{1,4}/g);a.yy=rs[0]-t.minY;a.mm=rs[1].replace(/-/g,"")-1;a.dd=rs[2].replace(/-/g,"")-1}else{a.yy=a.yy-t.minY}t.gearDate.querySelector(".date_yy").setAttribute("val",a.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",a.mm);t.gearDate.querySelector(".date_dd").setAttribute("val",a.dd);c()}function i(e){t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+'<div class="date_roll_mask">'+'<div class="ym_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";document.body.appendChild(t.gearDate);d();var a=t.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=t.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",p);var i=t.gearDate.querySelector(".date_yy");var n=t.gearDate.querySelector(".date_mm");i.addEventListener("touchstart",m);n.addEventListener("touchstart",m);i.addEventListener("touchmove",g);n.addEventListener("touchmove",g);i.addEventListener("touchend",_);n.addEventListener("touchend",_)}function d(){var e=new Date;var a={yy:e.getFullYear(),mm:e.getMonth()};if(/^\d{4}-\d{1,2}$/.test(t.trigger.value)){rs=t.trigger.value.match(/(^|-)\d{1,4}/g);a.yy=rs[0]-t.minY;a.mm=rs[1].replace(/-/g,"")-1}else{a.yy=a.yy-t.minY}t.gearDate.querySelector(".date_yy").setAttribute("val",a.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",a.mm);c()}function n(e){t.gearDate=document.createElement("div");t.gearDate.className="gearDatetime";t.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+'<div class="date_roll_mask">'+'<div class="datetime_roll">'+"<div>"+'<div class="gear date_yy" data-datetype="date_yy"></div>'+'<div class="date_grid">'+"<div>年</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_mm" data-datetype="date_mm"></div>'+'<div class="date_grid">'+"<div>月</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear date_dd" data-datetype="date_dd"></div>'+'<div class="date_grid">'+"<div>日</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_hh" data-datetype="time_hh"></div>'+'<div class="date_grid">'+"<div>时</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_mm" data-datetype="time_mm"></div>'+'<div class="date_grid">'+"<div>分</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";document.body.appendChild(t.gearDate);s();var a=t.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=t.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",D);var i=t.gearDate.querySelector(".date_yy");var d=t.gearDate.querySelector(".date_mm");var n=t.gearDate.querySelector(".date_dd");var v=t.gearDate.querySelector(".time_hh");var l=t.gearDate.querySelector(".time_mm");i.addEventListener("touchstart",m);d.addEventListener("touchstart",m);n.addEventListener("touchstart",m);v.addEventListener("touchstart",m);l.addEventListener("touchstart",m);i.addEventListener("touchmove",g);d.addEventListener("touchmove",g);n.addEventListener("touchmove",g);v.addEventListener("touchmove",g);l.addEventListener("touchmove",g);i.addEventListener("touchend",_);d.addEventListener("touchend",_);n.addEventListener("touchend",_);v.addEventListener("touchend",_);l.addEventListener("touchend",_)}function s(){var e=new Date;var a={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1,hh:e.getHours(),mi:e.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(t.trigger.value)){rs=t.trigger.value.match(/(^|-|\s|:)\d{1,4}/g);a.yy=rs[0]-t.minY;a.mm=rs[1].replace(/-/g,"")-1;a.dd=rs[2].replace(/-/g,"")-1;a.hh=parseInt(rs[3].replace(/\s0?/g,""));a.mi=parseInt(rs[4].replace(/:0?/g,""))}else{a.yy=a.yy-t.minY}t.gearDate.querySelector(".date_yy").setAttribute("val",a.yy);t.gearDate.querySelector(".date_mm").setAttribute("val",a.mm);t.gearDate.querySelector(".date_dd").setAttribute("val",a.dd);c();t.gearDate.querySelector(".time_hh").setAttribute("val",a.hh);t.gearDate.querySelector(".time_mm").setAttribute("val",a.mi);u()}function v(e){t.gearDate=document.createElement("div");t.gearDate.className="gearDate";t.gearDate.innerHTML='<div class="date_ctrl slideInUp">'+'<div class="date_btn_box">'+'<div class="date_btn lcalendar_cancel">取消</div>'+'<div class="date_btn lcalendar_finish">确定</div>'+"</div>"+'<div class="date_roll_mask">'+'<div class="time_roll">'+"<div>"+'<div class="gear time_hh" data-datetype="time_hh"></div>'+'<div class="date_grid">'+"<div>时</div>"+"</div>"+"</div>"+"<div>"+'<div class="gear time_mm" data-datetype="time_mm"></div>'+'<div class="date_grid">'+"<div>分</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";document.body.appendChild(t.gearDate);l();var a=t.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=t.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",E);var i=t.gearDate.querySelector(".time_hh");var d=t.gearDate.querySelector(".time_mm");i.addEventListener("touchstart",m);d.addEventListener("touchstart",m);i.addEventListener("touchmove",g);d.addEventListener("touchmove",g);i.addEventListener("touchend",_);d.addEventListener("touchend",_)}function l(){var e=new Date;var a={hh:e.getHours(),mm:e.getMinutes()};if(/^\d{2}:\d{2}$/.test(t.trigger.value)){rs=t.trigger.value.match(/(^|:)\d{2}/g);a.hh=parseInt(rs[0].replace(/^0?/g,""));a.mm=parseInt(rs[1].replace(/:0?/g,""))}t.gearDate.querySelector(".time_hh").setAttribute("val",a.hh);t.gearDate.querySelector(".time_mm").setAttribute("val",a.mm);u()}function c(){var e=t.maxY-t.minY+1;var a=t.gearDate.querySelector(".date_yy");var r="";if(a&&a.getAttribute("val")){var i=parseInt(a.getAttribute("val"));for(var d=0;d<=e-1;d++){r+="<div class='tooth'>"+(t.minY+d)+"</div>"}a.innerHTML=r;var n=Math.floor(parseFloat(a.getAttribute("top")));if(!isNaN(n)){n%2==0?n=n:n=n+1;n>8&&(n=8);var s=8-(e-1)*2;n<s&&(n=s);a.style["-webkit-transform"]="translate3d(0,"+n+"em,0)";a.setAttribute("top",n+"em");i=Math.abs(n-8)/2;a.setAttribute("val",i)}else{a.style["-webkit-transform"]="translate3d(0,"+(8-i*2)+"em,0)";a.setAttribute("top",8-i*2+"em")}}else{return}var v=t.gearDate.querySelector(".date_mm");if(v&&v.getAttribute("val")){r="";var l=parseInt(v.getAttribute("val"));var c=11;var u=0;if(i==e-1){c=t.maxM-1}if(i==0){u=t.minM-1}for(var d=0;d<c-u+1;d++){r+="<div class='tooth'>"+(u+d+1)+"</div>"}v.innerHTML=r;if(l>c){l=c;v.setAttribute("val",l)}else if(l<u){l=c;v.setAttribute("val",l)}v.style["-webkit-transform"]="translate3d(0,"+(8-(l-u)*2)+"em,0)";v.setAttribute("top",8-(l-u)*2+"em")}else{return}var m=t.gearDate.querySelector(".date_dd");if(m&&m.getAttribute("val")){r="";var g=parseInt(m.getAttribute("val"));var _=o(i,l);var h=_-1;var y=0;if(i==e-1&&t.maxM==l+1){h=t.maxD-1}if(i==0&&t.minM==l+1){y=t.minD-1}for(var d=0;d<h-y+1;d++){r+="<div class='tooth'>"+(y+d+1)+"</div>"}m.innerHTML=r;if(g>h){g=h;m.setAttribute("val",g)}else if(g<y){g=y;m.setAttribute("val",g)}m.style["-webkit-transform"]="translate3d(0,"+(8-(g-y)*2)+"em,0)";m.setAttribute("top",8-(g-y)*2+"em");var b=parseInt(m.getAttribute("val"));if(b<0){m.setAttribute("val",0);setTimeout(function(){m.style["-webkit-transform"]="translate3d(0,"+6+"em,0)";m.setAttribute("top",6+"em")},30)}}else{return}}function u(){var e=t.gearDate.querySelector(".time_hh");if(e&&e.getAttribute("val")){var a="";var r=parseInt(e.getAttribute("val"));for(var i=0;i<=23;i++){a+="<div class='tooth'>"+i+"</div>"}e.innerHTML=a;e.style["-webkit-transform"]="translate3d(0,"+(8-r*2)+"em,0)";e.setAttribute("top",8-r*2+"em")}else{return}var d=t.gearDate.querySelector(".time_mm");if(d&&d.getAttribute("val")){var a="";var n=parseInt(d.getAttribute("val"));for(var i=0;i<=59;i++){a+="<div class='tooth'>"+i+"</div>"}d.innerHTML=a;d.style["-webkit-transform"]="translate3d(0,"+(8-n*2)+"em,0)";d.setAttribute("top",8-n*2+"em")}else{return}}function o(e,a){if(a==1){e+=t.minY;if(e%4==0&&e%100!=0||e%400==0&&e%4e3!=0){return 29}else{return 28}}else{if(a==3||a==5||a==8||a==10){return 30}else{return 31}}}function m(e){e.preventDefault();var t=e.target;while(true){if(!t.classList.contains("gear")){t=t.parentElement}else{break}}clearInterval(t["int_"+t.id]);t["old_"+t.id]=e.targetTouches[0].screenY;t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");if(a){t["o_d_"+t.id]=parseFloat(a.replace(/em/g,""))}else{t["o_d_"+t.id]=0}t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function g(e){e.preventDefault();var t=e.target;while(true){if(!t.classList.contains("gear")){t=t.parentElement}else{break}}t["new_"+t.id]=e.targetTouches[0].screenY;t["n_t_"+t.id]=(new Date).getTime();var a=(t["new_"+t.id]-t["old_"+t.id])*30/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a;t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)";t.setAttribute("top",t["pos_"+t.id]+"em");if(e.targetTouches[0].screenY<1){_(e)}}function _(e){e.preventDefault();var t=e.target;while(true){if(!t.classList.contains("gear")){t=t.parentElement}else{break}}var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);if(Math.abs(a)<=.2){t["spd_"+t.id]=a<0?-.08:.08}else{if(Math.abs(a)<=.5){t["spd_"+t.id]=a<0?-.16:.16}else{t["spd_"+t.id]=a/2}}if(!t["pos_"+t.id]){t["pos_"+t.id]=0}h(t)}function h(e){var a=0;var r=false;function i(){e.style.webkitTransitionDuration=e.style.transitionDuration="200ms";r=true}var d=t.maxY-t.minY+1;clearInterval(e["int_"+e.id]);e["int_"+e.id]=setInterval(function(){if(!t.gearDate){clearInterval(e["int_"+e.id]);return}var n=e["pos_"+e.id];var s=e["spd_"+e.id]*Math.exp(-.03*a);n+=s;if(Math.abs(s)>.1){}else{var v=Math.round(n/2)*2;n=v;i()}if(n>8){n=8;i()}switch(e.dataset.datetype){case"date_yy":var l=8-(d-1)*2;if(n<l){n=l;i()}if(r){var c=Math.abs(n-8)/2;y(e,c);clearInterval(e["int_"+e.id])}break;case"date_mm":var u=t.gearDate.querySelector(".date_yy");var m=parseInt(u.getAttribute("val"));var g=11;var _=0;if(m==d-1){g=t.maxM-1}if(m==0){_=t.minM-1}var l=8-(g-_)*2;if(n<l){n=l;i()}if(r){var c=Math.abs(n-8)/2+_;y(e,c);clearInterval(e["int_"+e.id])}break;case"date_dd":var u=t.gearDate.querySelector(".date_yy");var h=t.gearDate.querySelector(".date_mm");var m=parseInt(u.getAttribute("val"));var b=parseInt(h.getAttribute("val"));var f=o(m,b);var p=f-1;var D=0;if(m==d-1&&t.maxM==b+1){p=t.maxD-1}if(m==0&&t.minM==b+1){D=t.minD-1}var l=8-(p-D)*2;if(n<l){n=l;i()}if(r){var c=Math.abs(n-8)/2+D;y(e,c);clearInterval(e["int_"+e.id])}break;case"time_hh":if(n<-38){n=-38;i()}if(r){var c=Math.abs(n-8)/2;y(e,c);clearInterval(e["int_"+e.id])}break;case"time_mm":if(n<-110){n=-110;i()}if(r){var c=Math.abs(n-8)/2;y(e,c);clearInterval(e["int_"+e.id])}break;default:}e["pos_"+e.id]=n;e.style["-webkit-transform"]="translate3d(0,"+n+"em,0)";e.setAttribute("top",n+"em");a++},30)}function y(e,t){t=Math.round(t);e.setAttribute("val",t);if(/date/.test(e.dataset.datetype)){c()}else{u()}}function b(e){e.preventDefault();var a;try{a=new CustomEvent("input")}catch(e){a=document.createEvent("Event");a.initEvent("input",true,true)}t.trigger.dispatchEvent(a);document.body.removeChild(t.gearDate);t.gearDate=null}function f(e){var a=t.maxY-t.minY+1;var r=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val")));var i=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1;i=i>9?i:"0"+i;var d=parseInt(Math.round(t.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d;t.trigger.value=r%a+t.minY+"-"+i+"-"+d;b(e)}function p(e){var a=t.maxY-t.minY+1;var r=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val")));var i=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1;i=i>9?i:"0"+i;t.trigger.value=r%a+t.minY+"-"+i;b(e)}function D(e){var a=t.maxY-t.minY+1;var r=parseInt(Math.round(t.gearDate.querySelector(".date_yy").getAttribute("val")));var i=parseInt(Math.round(t.gearDate.querySelector(".date_mm").getAttribute("val")))+1;i=i>9?i:"0"+i;var d=parseInt(Math.round(t.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=d>9?d:"0"+d;var n=parseInt(Math.round(t.gearDate.querySelector(".time_hh").getAttribute("val")));n=n>9?n:"0"+n;var s=parseInt(Math.round(t.gearDate.querySelector(".time_mm").getAttribute("val")));s=s>9?s:"0"+s;t.trigger.value=r%a+t.minY+"-"+i+"-"+d+" "+(n.length<2?"0":"")+n+(s.length<2?":0":":")+s;b(e)}function E(e){var a=parseInt(Math.round(t.gearDate.querySelector(".time_hh").getAttribute("val")));a=a>9?a:"0"+a;var r=parseInt(Math.round(t.gearDate.querySelector(".time_mm").getAttribute("val")));r=r>9?r:"0"+r;t.trigger.value=(a.length<2?"0":"")+a+(r.length<2?":0":":")+r;b(e)}t.trigger.addEventListener("click",{ym:i,date:a,datetime:n,time:v}[e])}};return e}();